/* visit counter Joomla! Plugin
 * 
 * @author Joachim Schmidt - joachim.schmidt@jschmidt-systemberatung.de
 * @copyright Copyright (C) 2013 Joachim Schmidt. All rights reserved.
 * @license http://www.gnu.org/licenses/gpl-2.0.html GNU/GPL
 * 
 * change activity: 
 *   01.02.2015: Release V2.0.0 for Joomla 3.x
 *   09.08.2022: add geolocation server check
 *   20.11.2023: add parameter option for url-base
 */
function check_Server(t){switch(t){case 1:var o="http://www.geoplugin.net/json.gp";fetch(o).then(function(t){return t.json()}).then(function(t){var e="  "+o+" responded with: \n";success=200==t.geoplugin_status?"success":"error";var n="\n\tstatus = "+success,s="\n\tip = "+t.geoplugin_request,i=t.geoplugin_countryCode,i="\n\tcountry = "+t.geoplugin_countryName+" ("+i+")";alert(e+n+s+i)}).catch(function(){alert("connection failed")});break;case 2:o="http://ip-api.com/json/";fetch(o).then(function(t){return t.json()}).then(function(t){var e="  "+o+" responded with: \n",n="\n\tstatus = "+t.status,s="\n\tip = "+t.query,i=t.countryCode,i="\n\tcountry = "+t.country+" ("+i+")";alert(e+n+s+i)}).catch(function(){alert("connection failed")});break;case 3:o="https://ip2c.org/77.55.235.217";fetch(o).then(t=>t.text()).then(t=>{var e=t.split(";"),n="\n\tstatus = "+(1==e[0]?"success":"error"),t=e[1],t="\n\tcountry = "+e[3]+" ("+t+")";alert("  https://ip2c.org  responded with: \n"+n+"\n\tip = 77.55.235.217"+t)}).catch(function(){alert("connection failed")});break;case 4:var e=document.getElementById("jform_params_server4").value;e.length<32&&(alert("  https://ipapi.co \n\n\tError: invalid or missing access key "+e),exit);o="https://ipapi.co/json/?key="+e;fetch(o).then(t=>t.json()).then(t=>{var e,n,s,i="  https://ipapi.co  responded with: \n";t.error?(e="\n\tstatus = error",n="\n\treason = "+t.reason,s="\n\tmessage = "+t.message,alert(i+e+n+s)):(e="\n\tstatus = success",n="\n\tip = "+t.ip,s=t.country_code,s="\n\tcountry = "+t.country_name+" ("+s+")",alert(i+e+n+s))}).catch(function(){alert("connection failed")});break;default:return void alert("server invalid")}}function jsvisit_getHTTPObject(){var e=!1;if(window.XMLHttpRequest)e=new XMLHttpRequest;else if(window.ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=!1}}return e}function jsvisit_setCookie(t,e,n){var s=new Date,i=document.location.hostname;s.setDate(s.getDate()+n);i=escape(e)+(null==n?"":"; expires="+s.toUTCString())+"; path=/; domain=."+i;document.cookie=t+"="+i}function jsvisit_getCookie(t){var e=document.cookie,n=e.indexOf(" "+t+"=");return-1==n&&(n=e.indexOf(t+"=")),e=-1==n?null:(n=e.indexOf("=",n)+1,-1==(t=e.indexOf(";",n))&&(t=e.length),unescape(e.substring(n,t)))}function jsvisitCountVisitors(t,e){var n,s,i,o=jsvisit_getHTTPObject();o&&(o.onreadystatechange=function(){jsvisit_parseResponse(o)},n=!0,0<t&&(s=new Date,i=jsvisit_getCookie("visitortime"),t=6e4*parseInt(t),s.getTime(),parseInt(i),null!=i&&""!=i&&s.getTime()<parseInt(i)+parseInt(t)&&(n=!1),value=s.getTime(),jsvisit_setCookie("visitortime",value,31)),n&&(e=e+"index.php?option=com_ajax&plugin=jsvisit_counter&group=system&format=raw",o.open("POST",e,!0),o.send(null)))}function jsvisit_parseResponse(t){4==t.readyState&&(200!=t.status&&304!=t.status||jsvisit_processReceived(t.responseText))}function jsvisit_processReceived(t){return!1}